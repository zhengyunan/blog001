<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title><?=$blog['title']?></title>
</head>
<style>
    .agree-list {
        border: 1px solid skyblue;
        padding: 0;
        text-align: center;
    }
    .avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: 1px solid skyblue;
        padding: 5px;
        margin-left: 20px;
    }
    .agree-list h3 {
        padding: 0;
        margin-top: 0;
        background-color: #EEE;
        padding: 5px;
    }
    </style>
<body>
        <h1>治疗系统</h1>
        <hr>
        <div id="menu"></div>
        
        
           
        
        
       
    <h1><?=e($blog['title'])?></h1>
    <p>浏览量：<span id="display"></span></p>
    <p><?=e($blog['content'])?></p>
    <img src="/images/dianzan.jpg" id="btn_agree" alt="">
    <div class="agree-list">
        <h3>点赞列表</h3>
        <div id="avatar-list">
            <img title="aaaa" class="avatar" src="/images/avatar.png" alt="">
        </div>
    </div>
    <?php view('common.footer') ?>
</body>
</html>

<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>

<script>
// 更新和获取游览量  并且获取登录时候的状态
// http://localhost:9999/blog/display?id=

// 获取当前日志的ID
var id = "<?=$blog['id']?>";
// 定义接口地址
// alert(id);
var url = "/blog/updated_display?id=" + id;
// 请求这个地址
$.ajax({
    type:"GET",
    url:url,
    dataType:'json',
    success:function(data)
    {
        // 把返回的浏览量放到页面
        $("#display").html(data.display);
        //无论是否登录都有首页
        var html = `<a href="/">首页</a>`;
        //判断是否登录
        if(data.email==''){
            html += `   <a href="/user/regist">注册</a>
                        <a href="/user/login">登录</a>`;
        }else{
            html += data.email+` <a href="/blog/index">日志列表</a>
                                   <a href="/blog/create">发表日志</a>
                                   <a href="/user/logout">退出</a>`;
        }

         // 获取id=menu的div 并把按钮放进去
          $("#menu").html(html);

    }
});
  $("#btn_agree").click(function(){
      $.ajax({
          type:"POST",
          url:"/blog/agreements?id="+id,
          dataType:"json",
          success:function(data){
              if(data.status_code==200){
                 alert('成功');
              }else{
                 alert(data.message);
              }
          }
      });
  });
  $.ajax({
      type:"GET",
      url:"/blog/agreements_list?id="+id,
      dataType:"json",
      success:function(data){
          if(data.status_code==200){
              console.log(data);
              var html = '';
              for(var i=0;i<data.data.length;i++){
                console.log(data.data.length);
                var avatar = data.data[i].avatar?data.data[i].avatar:'/images/avatar.gif';
                 html += '<img title="'+data.data[i].email+'" class="avatar" src="'+avatar+'" alt="">';
              }
              $("#avatar-list").html(html);

          }
      }
  })
</script>